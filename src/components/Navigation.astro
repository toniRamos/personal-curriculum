---
import { getLangFromUrl, useTranslations } from '../i18n/ui';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<nav class="navbar">
	<div class="nav-header">
		<a href="/" class="logo">
			<span class="logo-text">AR</span>
		</a>
	</div>
	
	<div class="nav-links">
		<a href="#about" class="nav-link">
			<span class="nav-number">01.</span>
			{t('nav.about')}
		</a>
		<a href="#experience" class="nav-link">
			<span class="nav-number">02.</span>
			{t('nav.experience')}
		</a>
		<a href="#projects" class="nav-link">
			<span class="nav-number">03.</span>
			{t('nav.projects')}
		</a>
		<a href="#contact" class="nav-link">
			<span class="nav-number">04.</span>
			{t('nav.contact')}
		</a>
	</div>

	<div class="nav-actions">
		<div class="language-selector">
			<select id="languageSelect" class="language-select">
				<option value="es" selected={lang === 'es'}>ES</option>
				<option value="en" selected={lang === 'en'}>EN</option>
			</select>
		</div>
	</div>

	<!-- Mobile menu button -->
	<div class="mobile-menu-toggle" id="mobile-menu-toggle">
		<span></span>
		<span></span>
		<span></span>
	</div>
</nav>

<!-- Mobile menu overlay -->
<div class="mobile-menu" id="mobile-menu">
	<div class="mobile-menu-content">
		<div class="mobile-nav-links">
			<a href="#about" class="mobile-nav-link">
				<span class="nav-number">01.</span>
				{t('nav.about')}
			</a>
			<a href="#experience" class="mobile-nav-link">
				<span class="nav-number">02.</span>
				{t('nav.experience')}
			</a>
			<a href="#projects" class="mobile-nav-link">
				<span class="nav-number">03.</span>
				{t('nav.projects')}
			</a>
			<a href="#contact" class="mobile-nav-link">
				<span class="nav-number">04.</span>
				{t('nav.contact')}
			</a>
		</div>
		<div class="mobile-language-selector">
			<select id="mobile-language-select" class="mobile-language-select">
				<option value="es" selected={lang === 'es'}>ES</option>
				<option value="en" selected={lang === 'en'}>EN</option>
			</select>
		</div>
	</div>
</div>

<style>
	.navbar {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		height: 100px;
		background-color: rgba(15, 23, 42, 0.85);
		backdrop-filter: blur(10px);
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 0 50px;
		z-index: 1000;
		transition: all 0.25s cubic-bezier(0.645, 0.045, 0.355, 1);
	}

	.navbar.scrolled {
		height: 70px;
		box-shadow: 0 10px 30px -10px rgba(2, 12, 27, 0.7);
	}

	.nav-header {
		z-index: 1001;
	}

	.logo {
		display: block;
		width: 42px;
		height: 42px;
		text-decoration: none;
		transition: all 0.3s ease;
	}

	.logo:hover {
		text-decoration: none;
	}

	.logo-text {
		display: flex;
		justify-content: center;
		align-items: center;
		width: 100%;
		height: 100%;
		border: 2px solid #64ffda;
		border-radius: 3px;
		color: #64ffda;
		font-size: 20px;
		font-weight: 400;
		background: rgba(100, 255, 218, 0.05);
		box-shadow: 
			0 0 15px rgba(100, 255, 218, 0.2),
			inset 0 0 15px rgba(100, 255, 218, 0.1);
		filter: blur(0.5px);
		transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
		animation: logoGentleGlow 4s ease-in-out infinite alternate;
	}

	.logo:hover .logo-text {
		background-color: rgba(100, 255, 218, 0.15);
		filter: blur(0px);
		box-shadow: 
			0 0 25px rgba(100, 255, 218, 0.4),
			inset 0 0 20px rgba(100, 255, 218, 0.15);
		transform: scale(1.05);
	}

	.nav-links {
		display: flex;
		align-items: center;
		list-style: none;
		margin: 0;
		padding: 0;
		gap: 35px;
	}

	.nav-link {
		color: #cbd5e1;
		font-size: 13px;
		font-weight: 400;
		letter-spacing: 0.1em;
		text-transform: uppercase;
		padding: 10px 0;
		transition: all 0.25s cubic-bezier(0.645, 0.045, 0.355, 1);
		text-decoration: none;
	}

	.nav-link:hover {
		color: #64ffda;
		text-decoration: none;
	}

	.nav-number {
		color: #64ffda;
		font-size: 12px;
		font-weight: 400;
		margin-right: 8px;
	}

	.nav-actions {
		display: flex;
		align-items: center;
		gap: 20px;
		z-index: 1001;
	}

	.language-selector {
		position: relative;
	}

	.language-select {
		background: transparent;
		border: 1px solid #64ffda;
		border-radius: 4px;
		color: #64ffda;
		padding: 8px 12px;
		font-size: 13px;
		font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
		cursor: pointer;
		transition: all 0.25s cubic-bezier(0.645, 0.045, 0.355, 1);
		appearance: none;
		background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%2364ffda' viewBox='0 0 16 16'%3e%3cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3e%3c/svg%3e");
		background-repeat: no-repeat;
		background-position: right 8px center;
		background-size: 12px;
		padding-right: 30px;
	}

	.language-select:hover {
		background-color: rgba(100, 255, 218, 0.1);
	}

	.language-select:focus {
		outline: none;
		box-shadow: 0 0 0 2px rgba(100, 255, 218, 0.2);
	}

	.mobile-menu-toggle {
		display: none;
		flex-direction: column;
		width: 30px;
		height: 30px;
		cursor: pointer;
		z-index: 1001;
	}

	.mobile-menu-toggle span {
		width: 100%;
		height: 2px;
		background-color: #64ffda;
		margin: 3px 0;
		transition: all 0.3s ease;
	}

	.mobile-menu-toggle.active span:nth-child(1) {
		transform: rotate(45deg) translate(5px, 5px);
	}

	.mobile-menu-toggle.active span:nth-child(2) {
		opacity: 0;
	}

	.mobile-menu-toggle.active span:nth-child(3) {
		transform: rotate(-45deg) translate(7px, -6px);
	}

	.mobile-menu {
		position: fixed;
		top: 0;
		right: -100%;
		width: 100%;
		height: 100vh;
		background-color: rgba(15, 23, 42, 0.98);
		backdrop-filter: blur(10px);
		transition: right 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
		z-index: 999;
		display: none;
	}

	.mobile-menu.active {
		right: 0;
	}

	.mobile-menu-content {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		height: 100%;
		padding: 50px;
	}

	.mobile-nav-links {
		display: flex;
		flex-direction: column;
		gap: 30px;
		text-align: center;
		margin-bottom: 40px;
	}

	.mobile-nav-link {
		color: #cbd5e1;
		font-size: 18px;
		font-weight: 400;
		letter-spacing: 0.1em;
		text-transform: uppercase;
		text-decoration: none;
		transition: all 0.25s cubic-bezier(0.645, 0.045, 0.355, 1);
		padding: 10px 0;
	}

	.mobile-nav-link:hover {
		color: #64ffda;
	}

	.mobile-nav-link .nav-number {
		color: #64ffda;
		font-size: 16px;
		display: block;
		margin-bottom: 5px;
	}

	.mobile-language-selector {
		margin-top: 20px;
	}

	.mobile-language-select {
		background: transparent;
		border: 1px solid #64ffda;
		border-radius: 4px;
		color: #64ffda;
		padding: 12px 16px;
		font-size: 16px;
		font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
		cursor: pointer;
		transition: all 0.25s cubic-bezier(0.645, 0.045, 0.355, 1);
		appearance: none;
		background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%2364ffda' viewBox='0 0 16 16'%3e%3cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3e%3c/svg%3e");
		background-repeat: no-repeat;
		background-position: right 12px center;
		background-size: 12px;
		padding-right: 40px;
	}

	.mobile-language-select:hover {
		background-color: rgba(100, 255, 218, 0.1);
	}

	@media (max-width: 768px) {
		.navbar {
			padding: 0 25px;
		}

		.nav-links {
			display: none;
		}

		.mobile-menu-toggle {
			display: flex;
		}

		.mobile-menu {
			display: block;
		}
	}

	/* Animaci√≥n sutil para el logo similar al loader */
	@keyframes logoGentleGlow {
		0% {
			filter: blur(0.5px);
			box-shadow: 
				0 0 15px rgba(100, 255, 218, 0.2),
				inset 0 0 15px rgba(100, 255, 218, 0.1);
		}
		50% {
			filter: blur(0.8px);
			box-shadow: 
				0 0 20px rgba(100, 255, 218, 0.3),
				inset 0 0 18px rgba(100, 255, 218, 0.15);
		}
		100% {
			filter: blur(0.3px);
			box-shadow: 
				0 0 12px rgba(100, 255, 218, 0.15),
				inset 0 0 12px rgba(100, 255, 218, 0.08);
		}
	}
</style>

<script>
	// Scroll behavior for navbar
	let lastScrollTop = 0;
	const navbar = document.querySelector('.navbar');
	
	window.addEventListener('scroll', () => {
		const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
		
		if (scrollTop > 100) {
			navbar?.classList.add('scrolled');
		} else {
			navbar?.classList.remove('scrolled');
		}
		
		lastScrollTop = scrollTop;
	});

	// Smooth scrolling for anchor links
	document.querySelectorAll('a[href^="#"]').forEach(anchor => {
		anchor.addEventListener('click', function (e) {
			e.preventDefault();
			const target = document.querySelector(this.getAttribute('href'));
			if (target) {
				target.scrollIntoView({
					behavior: 'smooth',
					block: 'start'
				});
			}
		});
	});

	// Language selector functionality
	const languageSelect = document.getElementById('languageSelect');
	const mobileLanguageSelect = document.getElementById('mobile-language-select');
	
	function handleLanguageChange(selectedLang) {
		const currentPath = window.location.pathname;
		
		if (selectedLang === 'en') {
			// Navigate to English version
			if (currentPath === '/') {
				window.location.href = '/en/';
			} else if (currentPath.startsWith('/en')) {
				// Already in English, do nothing
				return;
			} else {
				window.location.href = '/en' + currentPath;
			}
		} else {
			// Navigate to Spanish version (default)
			if (currentPath.startsWith('/en/')) {
				const newPath = currentPath.replace('/en/', '/');
				window.location.href = newPath === '/' ? '/' : newPath;
			} else if (currentPath === '/en') {
				window.location.href = '/';
			} else {
				// Already in Spanish, do nothing
				return;
			}
		}
	}

	if (languageSelect) {
		// Set initial value based on current URL
		const currentPath = window.location.pathname;
		const isEnglish = currentPath.startsWith('/en');
		languageSelect.value = isEnglish ? 'en' : 'es';
		
		languageSelect.addEventListener('change', function(e) {
			handleLanguageChange(e.target.value);
		});
	}

	if (mobileLanguageSelect) {
		// Set initial value based on current URL
		const currentPath = window.location.pathname;
		const isEnglish = currentPath.startsWith('/en');
		mobileLanguageSelect.value = isEnglish ? 'en' : 'es';
		
		mobileLanguageSelect.addEventListener('change', function(e) {
			handleLanguageChange(e.target.value);
		});
	}

	// Mobile menu functionality  
	const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
	const mobileMenu = document.getElementById('mobile-menu');
	const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
	
	if (mobileMenuToggle && mobileMenu) {
		mobileMenuToggle.addEventListener('click', function() {
			mobileMenuToggle.classList.toggle('active');
			mobileMenu.classList.toggle('active');
			
			// Prevent body scroll when menu is open
			if (mobileMenu.classList.contains('active')) {
				document.body.style.overflow = 'hidden';
			} else {
				document.body.style.overflow = 'auto';
			}
		});

		// Close menu when clicking on navigation links
		mobileNavLinks.forEach(link => {
			link.addEventListener('click', function() {
				mobileMenuToggle.classList.remove('active');
				mobileMenu.classList.remove('active');
				document.body.style.overflow = 'auto';
			});
		});

		// Close menu when clicking outside
		mobileMenu.addEventListener('click', function(e) {
			if (e.target === mobileMenu) {
				mobileMenuToggle.classList.remove('active');
				mobileMenu.classList.remove('active');
				document.body.style.overflow = 'auto';
			}
		});

		// Close menu on escape key
		document.addEventListener('keydown', function(e) {
			if (e.key === 'Escape' && mobileMenu.classList.contains('active')) {
				mobileMenuToggle.classList.remove('active');
				mobileMenu.classList.remove('active');
				document.body.style.overflow = 'auto';
			}
		});
	}
</script>
